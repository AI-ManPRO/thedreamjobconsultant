
const fs = require('fs');
const path = require('path');

// Directories to scan
const PAGES_DIR = path.join(__dirname, '../src/pages');
const DATA_DIR = path.join(__dirname, '../src/data'); // Also include data files like blog posts

// Output file
const OUTPUT_FILE = path.join(__dirname, '../src/data/company-knowledge.ts');

let allContent = '';

function scanDirectory(directory) {
  if (!fs.existsSync(directory)) return;

  const files = fs.readdirSync(directory);

  files.forEach(file => {
    const fullPath = path.join(directory, file);
    const stat = fs.statSync(fullPath);

    if (stat.isDirectory()) {
      scanDirectory(fullPath);
    } else if (file.endsWith('.tsx') || file.endsWith('.ts')) {
      // Skip the output file itself and the persona prompt to avoid duplication/circular deps
      if (fullPath === OUTPUT_FILE || file === 'persona-prompt.ts' || file === 'company-knowledge.ts') return;

      const content = fs.readFileSync(fullPath, 'utf-8');

      // Basic cleanup to remove imports and reduce noise
      // We keep the structure but remove import lines to save tokens
      const cleanedContent = content
        .split('\n')
        .filter(line => !line.trim().startsWith('import '))
        .join('\n');

      allContent += `\n\n--- START OF FILE: ${file} ---\n`;
      allContent += cleanedContent;
      allContent += `\n--- END OF FILE: ${file} ---\n`;
    }
  });
}

console.log('Scanning src/pages...');
scanDirectory(PAGES_DIR);
console.log('Scanning src/data...');
scanDirectory(DATA_DIR);

const fileContent = `
// THIS FILE IS AUTO-GENERATED - DO NOT EDIT MANUALLY
// Generated by scripts/extract-knowledge.cjs

export const COMPANY_KNOWLEDGE = ${JSON.stringify(allContent)};
`;

fs.writeFileSync(OUTPUT_FILE, fileContent);
console.log(`Successfully generated ${ OUTPUT_FILE } with ${ allContent.length } characters of knowledge.`);
